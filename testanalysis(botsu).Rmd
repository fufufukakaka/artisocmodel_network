---
title: "testanalysis"
author: "Yusuke Fukasawa"
date: "2015年11月18日"
output: html_document
---

単年度で一度回してみましたので
PostgreSQLに研究室のMacからつなげられないもんかなあ

```{r}
#PostgreSQLにつなぐためのコード
require(RPostgreSQL)
con <- dbConnect(PostgreSQL(),host="localhost",user="postgres",password="fukasawa1225",dbname="db_artisoc")
bridge <- dbGetQuery(con,"SELECT * FROM bridgelog where simulationcode ='2015/11/19littletest'")
```

```{r}
require(ggplot2)
bridge<-read.csv("bridgetest1.csv")
bridge<-bridge[,c(-1,-2)]
g<-ggplot(
  bridge,
  aes(
    x = day,
    y = strength,
    group = bridgeid
  )
)
g <- g + geom_line()
plot(g)
```

橋が全く潰れていない模様

```{r}
govern<-read.csv("governtest1.csv")
govern<-govern[,c(-1,-2)]
g<-ggplot(
  govern,
  aes(
    x = day,
    y = budget
  )
)
g <- g + geom_line()
plot(g)
```

こんだけ直してれば予算もガリガリ減っていることだろうと思ったら全く減っておらずむしろ増えている模様
税率が高すぎる？
personのmoneyもとるべきだったなあ

personについても色々見てみましたが、橋が減ってないのでずっと同じ動きをしておりますね

はい、やり直し〜

あのあと"2015/11/18littletest","2015/11/18bigtest"でそれぞれ0.2,0.8基準でやってみました。

取り敢えず橋の耐久値を正しく検知しない問題は解決されました「が、相変わらず政府の予算は増える一方だし、50年分やってるのに0.2にいくやつがひとつもない。ここに乗せるまでもない。ので割愛。

更に言うとbridge0はなぜか耐久値が一向に減らない。。。

橋が壊れるとかしないと、殆ど効果を測れないモデルなので、何とかして壊れて頂く必要がある。
徴税額が多すぎるのか、archive_sumが0に初期化されていないのか、橋の修復費用が低すぎるのかはよくわからないので調べないと。

取り敢えず人が橋に与える負荷はもっとおおきくしていいってことがわかった！

11/19に修正してみたモデルでの結果
```{r}
bridge <- dbGetQuery(con,"SELECT * FROM bridgelog where simulationcode ='2015/11/19littletest'")
bridge<-bridge[,-1]
require(ggplot2)
g<-ggplot(
bridge,
aes(
x = day,
y = strength,
group = bridgeid
)
)
g <- g + geom_line()
plot(g)
bridge2 <- dbGetQuery(con,"SELECT * FROM bridgelog where simulationcode ='2015/11/19bigtest'")
bridge2<-bridge2[,-1]
gg1<-ggplot(
bridge2,
aes(
x = day,
y = strength,
group = bridgeid
)
)
gg1 <- gg1 + geom_line()
plot(gg1)
```

ほうほうといったところ
せいふよさんもみてみる
```{r}
govern1 <- dbGetQuery(con,"SELECT * FROM governmentlog where simulationcode ='2015/11/19littletest'")
govern2 <- dbGetQuery(con,"SELECT * FROM governmentlog where simulationcode ='2015/11/19bigtest'")
govern1<-govern1[,-1]
govern2<-govern2[,-1]
ggg1<-ggplot(
govern1,
aes(
x = day,
y = budget
)
)
ggg1 <- ggg1 + geom_line()
plot(ggg1)
gg2<-ggplot(
govern2,
aes(
x = day,
y = budget
)
)
gg2 <- gg2 + geom_line()
plot(gg2)
```

政府予算はやはりまるでへっていないので何とかしないと
最後に政府予算を半分の50億から始めた場合
```{r}
bridge3 <- dbGetQuery(con,"SELECT * FROM bridgelog where simulationcode ='2015/11/19littlebudgethalftest'")
govern3 <- dbGetQuery(con,"SELECT * FROM governmentlog where simulationcode ='2015/11/19littlebudgethalftest'")
bridge3<-bridge3[,-1]
govern3<-govern3[,-1]
g3<-ggplot(
bridge3,
aes(
x = day,
y = strength,
group = bridgeid
)
)
g3 <- g3 + geom_line()
plot(g3)
gg3<-ggplot(
govern3,
aes(
x = day,
y = budget
)
)
gg3 <- gg3 + geom_line()
plot(gg3)
```

うん、これ橋の修繕費が低すぎるか徴税額が多すぎるのかどっちかだな

```{r}
person3 <- dbGetQuery(con,"SELECT * FROM personlog where simulationcode ='2015/11/19littlebudgethalftest'")
gp<-ggplot(
person3,
aes(
x = day,
y = money,
group=personid
)
)
gp <- gp + geom_line()
plot(gp)
```

橋の修繕に費用が掛かっていなかったことが原因の模様

ということで修正したのがコード"2015/11/20littletest"

```{r}
bridge<- dbGetQuery(con,"SELECT * FROM bridgelog where simulationcode ='2015/11/20littletest'")
go<- dbGetQuery(con,"SELECT * FROM governmentlog where simulationcode ='2015/11/20littletest'")
pe<- dbGetQuery(con,"SELECT * FROM personlog where simulationcode ='2015/11/20littletest'")
```